<!DOCTYPE html> 
<html lang="hy">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>‘π’∏÷Ç’¥’°’∂’µ’°’∂’°’Ø’°’∂ ‘±’∑’≠’°÷Ä’∞</title>
    <script src="https://unpkg.com/peerjs@1.4.7/dist/peerjs.min.js"></script>
    <style>
        :root { --bg: #051e11; --card-bg: #0f3621; --accent: #d4a017; --text: #f0f7f4; --wrong: #c0392b; --correct: #27ae60; }
        
        body { 
            font-family: 'Segoe UI', sans-serif; 
            background: var(--bg); 
            color: var(--text); 
            display: flex; flex-direction: column; align-items: center; 
            margin: 0; padding: 5px; 
            min-height: 100vh;
            overflow-x: hidden; 
            user-select: none; 
            -webkit-tap-highlight-color: transparent;
        }

        .hidden { display: none !important; }
        h1 { margin: 10px 0; text-align: center; color: var(--accent); text-shadow: 0 0 10px rgba(212,160,23,0.3); font-size: 28px; }
        @media (min-width: 768px) { h1 { font-size: 36px; } }
        .subtitle { color: #8fbc8f; margin-bottom: 20px; font-style: italic; text-align: center; font-size: 14px; }
        
        /* --- ’ë‘±’Ü’ë (GRID) - ’Ñ‘ª’á’è 7 ’ç’Ö’à’í’Ü‘±‘ø --- */
        .grid { 
            display: grid; 
            width: 100%; 
            max-width: 1200px; 
            margin: 0 auto;
            gap: 4px; 
            padding-bottom: 40px;
            grid-template-columns: repeat(7, 1fr) !important; 
        }

        /* ‘≤’°’º’•÷Ä’´ ’∏’≥’°’æ’∏÷Ä’∏÷Ç’¥ */
        .word { 
            background: #e8f5e9; color: #051e11; 
            padding: 2px; border-radius: 4px; 
            cursor: pointer; text-align: center; 
            font-weight: 700; font-size: 9px; 
            min-height: 45px; 
            display: flex; align-items: center; justify-content: center; 
            transition: 0.1s; box-shadow: 0 2px 0 #2e5c44; 
            word-break: break-word; line-height: 1.1; hyphens: auto;
        }

        @media (min-width: 768px) {
            .grid { gap: 10px; }
            .word { font-size: 16px; padding: 10px; min-height: 70px; border-radius: 8px; box-shadow: 0 4px 0 #2e5c44; }
        }

        .word:active { transform: translateY(2px); box-shadow: none; }
        .word.used { opacity: 0; pointer-events: none; transform: scale(0.5); transition: 0.3s; }
        .word.error { background: var(--wrong); color: white; animation: shake 0.4s; }
        .word.correct { background: var(--correct); color: white; }

        /* ’Ñ’•’∂’µ’∏÷Ç */
        .main-menu-grid { display: flex; gap: 20px; justify-content: center; flex-wrap: wrap; margin-top: 30px; width: 100%; }
        .main-card { width: 100%; max-width: 300px; height: 150px; background: linear-gradient(145deg, #0f3621, #0a2516); border: 3px solid var(--accent); border-radius: 20px; cursor: pointer; display: flex; flex-direction: column; align-items: center; justify-content: center; transition: 0.3s; box-shadow: 0 10px 20px rgba(0,0,0,0.5); text-align: center; padding: 10px; margin: 5px; }
        @media (min-width: 768px) { .main-card { height: 220px; padding: 15px; margin: 10px; } }
        .main-card:active, .main-card:hover { transform: scale(0.98); background: var(--accent); }
        .main-card:active h2, .main-card:hover h2 { color: #051e11; }
        .main-card h2 { color: var(--accent); margin: 0; font-size: 20px; }
        .main-card p { color: #aaa; margin-top: 5px; font-size: 12px; }

        /* ’è’•’≤’°’µ’´’∂ ‘Ω’°’≤ */
        .local-game-container { width: 100%; max-width: 1400px; display: flex; flex-direction: column; align-items: center; }
        .teams-row { display: flex; width: 100%; gap: 5px; margin-bottom: 10px; }
        .team-card { flex: 1; background: var(--card-bg); padding: 5px; border-radius: 8px; border: 2px solid #2e5c44; text-align: center; transition: 0.3s; min-width: 0; }
        .team-card.turn { border-color: var(--accent); background: #14402a; box-shadow: 0 0 10px var(--accent); }
        .team-name { font-size: 14px; color: #fff; font-weight: bold; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        .team-score { font-size: 24px; font-weight: 900; color: #fff; margin: 2px 0; }
        .team-list { height: 50px; overflow-y: auto; text-align: left; color: #a8d5ba; font-size: 10px; border-top: 1px solid #2e5c44; margin-top: 2px; padding-top: 2px; }
        @media (min-width: 768px) {
            .teams-row { gap: 15px; margin-bottom: 20px; }
            .team-card { padding: 15px; border-radius: 12px; }
            .team-name { font-size: 24px; }
            .team-score { font-size: 60px; }
            .team-list { height: 100px; font-size: 16px; }
        }

        /* ’ï’∂’¨’°’µ’∂ ‘º’∏’¢’¢’´ */
        .lobby-box { background: rgba(15, 54, 33, 0.95); padding: 20px; border-radius: 20px; border: 2px solid var(--accent); text-align: center; max-width: 500px; width: 95%; margin-top: 10px; }
        .room-code { font-size: 30px; letter-spacing: 3px; background: black; color: white; padding: 10px; border-radius: 10px; display: inline-block; margin: 10px 0; border: 2px dashed var(--accent); }
        input { padding: 10px; font-size: 16px; border-radius: 10px; width: 90%; margin: 10px 0; text-align: center; box-sizing: border-box; }
        .player-list { display: flex; flex-wrap: wrap; gap: 5px; justify-content: center; margin-top: 10px; }
        .player-tag { background: #14402a; padding: 5px 10px; border-radius: 15px; border: 1px solid var(--accent); font-weight: bold; font-size: 12px; }

        /* ‘ø’∏’≥’°’Ø’∂’•÷Ä */
        .btn { padding: 10px 20px; font-size: 16px; border: none; border-radius: 10px; cursor: pointer; font-weight: bold; color: white; margin: 5px; transition: 0.2s; width: 100%; max-width: 250px; }
        .btn-gold { background: var(--accent); color: #051e11; }
        .btn-blue { background: #2980b9; }
        .btn-red { background: #c0392b; }
        .btn-back { position: fixed; top: 10px; left: 10px; background: #34495e; font-size: 12px; padding: 5px 10px; z-index: 1000; width: auto; }

        /* Leaderboard */
        .leaderboard { width: 95%; max-width: 1400px; margin-top: 20px; }
        .lb-row { display: flex; align-items: center; background: #14402a; margin-bottom: 15px; padding: 15px 25px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.3); }
        .lb-name { flex: 1; text-align: left; font-weight: 900; font-size: 32px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; color: #fff; text-shadow: 1px 1px 2px black; }
        .lb-stat { margin: 0 25px; font-size: 28px; font-weight: bold; min-width: 60px; text-align: right; color: #ffd700; }
        .bar-container { flex: 2; background: #051e11; height: 25px; border-radius: 12px; margin: 0 20px; overflow: hidden; display: none; border: 2px solid #2e5c44; }
        @media (min-width: 500px) { .bar-container { display: block; } }
        .bar-fill { height: 100%; background: linear-gradient(90deg, #d4a017, #f1c40f); width: 0%; transition: width 0.5s ease-in-out; }

        /* Player Screen Elements */
        #player-collected-lines {
            width: 90%; min-height: 40px;
            background: rgba(0,0,0,0.3);
            border: 1px solid var(--accent);
            border-radius: 10px; margin-bottom: 10px; padding: 10px;
            color: #ffd700; font-style: italic; font-size: 14px;
            line-height: 1.4; white-space: pre-line; text-align: left;
        }
        
        #player-final-screen {
            display: none; width: 100%; flex-direction: column; align-items: center; text-align: center; animation: fadeIn 0.5s; padding-top: 50px;
        }
        .result-rank { font-size: 60px; margin: 10px 0; }
        .result-title { font-size: 28px; font-weight: bold; color: var(--accent); margin-bottom: 10px; }
        .result-stats { font-size: 20px; color: white; margin-bottom: 20px; }
        .result-msg { font-size: 18px; color: #8fbc8f; font-style: italic; padding: 0 20px; }

        /* Winner Overlay (Host & Common) */
        #winner-overlay { 
            display: none; position: fixed; top: 0; left: 0; 
            width: 100%; height: 100%; 
            background: rgba(5,30,17,0.98); 
            z-index: 2147483647; 
            flex-direction: column; align-items: center; justify-content: center; text-align: center; 
            padding: 10px; box-sizing: border-box; overflow-y: auto;
        }

        .winner-table { width: 100%; max-width: 700px; text-align: left; border-collapse: collapse; margin-top: 10px; background: rgba(0,0,0,0.5); border-radius: 15px; padding: 10px; }
        .winner-table td { padding: 8px; border-bottom: 1px solid #444; vertical-align: middle; }
        .winner-team-name { font-size: 22px; font-weight: 900; display: block; margin-bottom: 2px; } 
        .winner-stats { font-size: 14px; color: #aaa; font-weight: normal; } 
        
        .rank-1 .winner-team-name { color: #ffd700; text-shadow: 0 0 10px rgba(255, 215, 0, 0.6); } 
        .rank-2 .winner-team-name { color: #c0c0c0; } 
        .rank-3 .winner-team-name { color: #cd7f32; } 

        #local-counter { position: absolute; top: 5px; right: 5px; font-size: 12px; color: var(--accent); font-weight: bold; background: #000; padding: 3px 8px; border-radius: 5px; }
        @media (min-width: 768px) { #local-counter { top: 10px; right: 10px; font-size: 18px; padding: 5px 10px; } }

        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body>

    <button class="btn btn-back hidden" id="global-back-btn" onclick="goToMainMenu()">üè†</button>

    <div id="screen-main-menu">
        <h1>‘π’à’í’Ñ‘±’Ü’Ö‘±’Ü‘±‘ø‘±’Ü ‘±’á‘Ω‘±’ê’Ä</h1>
        <div class="subtitle">‘∏’∂’ø÷Ä’•÷Ñ ’≠’°’≤’´ ’±÷á’°’π’°÷É’®</div>
        
        <div class="main-menu-grid">
            <div class="main-card" onclick="startLocalMode()">
                <h2>3 ‘π’´’¥’•÷Ä’´ ’ä’°’µ÷Ñ’°÷Ä</h2>
                <p>’ç’∏’æ’∏÷Ä’°’Ø’°’∂ ’º’•’™’´’¥<br>(6 ‘Ω’°’≤)</p>
            </div>
            <div class="main-card" onclick="openOnlinePortal('solo')">
                <h2>’à÷Ç’∑’°’§÷Ä’∏÷Ç’©’µ’°’∂ ’ì’∏÷Ä’±’∏÷Ç’©’µ’∏÷Ç’∂</h2>
                <p>’ï’∂’¨’°’µ’∂ </p>
            </div>
            <div class="main-card" onclick="openOnlinePortal('sequence')">
                <h2>’Ä’°’æ’°÷Ñ’´÷Ä ’è’∏’≤’•÷Ä’®</h2>
                <p>’ï’∂’¨’°’µ’∂ </p>
            </div>
        </div>
    </div>

    <div id="screen-local-game" class="local-game-container hidden">
        <h1 style="margin-top:0;">3 ‘π’´’¥’•÷Ä’´ ’ä’°’µ÷Ñ’°÷Ä</h1>
        <div id="local-menu" style="display:flex; gap:10px; flex-wrap:wrap; justify-content:center; margin-bottom:20px;"></div>
        
        <div id="local-game-board" class="hidden" style="width:100%; display:flex; flex-direction:column; align-items:center; position:relative;">
            <div id="local-counter">0 / 28</div>
            <h2 id="local-game-title" style="text-align:center; color:var(--accent); font-size: 20px;"></h2>
            <div id="local-msg" style="text-align:center; font-size:16px; margin:5px;">’ç’Ø’Ω’∏÷Ç’¥ ’ß ‘π’´’¥ 1-’®</div>
            
            <div class="teams-row" id="local-teams"></div>
            <div class="grid" id="local-grid"></div>
            <div style="text-align:center; margin-top:5px;">
                <button class="btn btn-gold" onclick="localUndo()">‚Ü∫ ’Ä‘µ’è ’è‘±‘º</button>
            </div>
        </div>
    </div>

    <div id="screen-online-portal" class="hidden lobby-box">
        <h1 id="online-portal-title"></h1>
        <button class="btn btn-gold" onclick="setupHost()">’ç’è‘µ’Ç‘æ‘µ‘º ’ç‘µ’Ü’Ö‘±‘ø<br><span style="font-size:12px">(’à÷Ç’Ω’∏÷Ç÷Å’´’π/‘∑’Ø÷Ä’°’∂)</span></button>
        <div style="margin:20px; border-top:1px solid #555"></div>
        <input type="text" id="p-name" placeholder="’î’∏ ‘±’∂’∏÷Ç’∂’®">
        <input type="number" id="p-code" placeholder="’ç’•’∂’µ’°’Ø’´ ‘ø’∏’§’®">
        <button class="btn btn-blue" onclick="joinRoom()">’Ñ‘ª‘±’Ü‘±‘º<br><span style="font-size:12px">(‘±’∑’°’Ø’•÷Ä’ø/’Ä’•’º’°’≠’∏’Ω)</span></button>
    </div>

    <div id="screen-host-lobby" class="hidden lobby-box">
        <h2>’ç‘µ’Ü’Ö‘±‘ø‘ª ‘ø’à‘¥‘∏</h2>
        <div class="room-code" id="host-code-display"></div>
        <p>’ç’∫’°’Ω’∏÷Ç’¥ ’•’∂÷Ñ ’¥’°’Ω’∂’°’Ø’´÷Å’∂’•÷Ä’´’∂...</p>
        <div class="player-list" id="host-player-list"></div>
        <div style="margin-top:20px; border-top:1px solid #555; padding-top:10px;">
            <h3>‘∏’∂’ø÷Ä’•÷Ñ ’≠’°’≤’®</h3>
            <div id="host-game-list" style="display:flex; gap:5px; flex-wrap:wrap; justify-content:center;"></div>
        </div>
    </div>

    <div id="screen-host-live" class="hidden" style="width:100%; text-align:center;">
        <h1 id="live-game-title">‘Ω’°’≤’® ’®’∂’©’°’∂’∏÷Ç’¥ ’ß</h1>
        <div class="leaderboard" id="live-leaderboard" style="margin: 0 auto;"></div>
        <button class="btn btn-red" style="margin-top:20px; font-size:20px; padding:10px 30px;" onclick="endOnlineGame()">‘±’é‘±’ê’è‘µ‘º ‘µ’é ‘±’Ñ’ì’à’ì‘µ‘º</button>
    </div>

    <div id="screen-player" class="hidden" style="width:100%; text-align:center;">
        <div id="player-waiting">
            <h1>’ç’ä‘±’ç’à’í’Ñ ‘µ’Ü’î...</h1>
            <p>’Ü’°’µ’•÷Ñ ’¥’•’Æ ’ß’Ø÷Ä’°’∂’´’∂</p>
        </div>
        <div id="player-playing" class="hidden">
            <h3 id="player-target" style="color:var(--accent); font-size:16px; margin: 10px 0;"></h3>
            <div id="player-collected-lines" class="hidden"></div>
            <div class="grid" id="player-grid"></div>
        </div>
        <div id="player-final-screen">
            <div class="result-rank" id="p-final-rank"></div>
            <div class="result-title" id="p-final-title"></div>
            <div class="result-stats" id="p-final-stats"></div>
            <div class="result-msg" id="p-final-msg"></div>
        </div>
    </div>

    <div id="winner-overlay">
        <h1 class="win-title" id="final-winner-title" style="font-size: 36px; margin-bottom: 10px; color: var(--accent);"></h1>
        <div id="winner-name" style="width:100%; display:flex; justify-content:center;"></div>
        <button class="btn back-btn" style="margin-top: 20px; font-size: 18px; background: var(--accent); color: #000; position:static;" onclick="forceBackToMenu()">üè† ’Ñ‘µ’Ü’Ö’à’í</button>
    </div>

<script>
    const peerConfig = { config: { iceServers: [{ urls: 'stun:stun.l.google.com:19302' }, { urls: 'stun:global.stun.twilio.com:3478' }] } };

    // --- ’è’é’Ö‘±‘º’Ü‘µ’ê ---
    const DB = {
        standard: [
            { name: "’Ä’•÷Ñ’´’°’©’´ ’Ä’•÷Ä’∏’Ω’∂’•÷Ä", teams: ["’Å‘±‘Ω’à’ê‘¥ ’ì‘±’Ü’à’ç", "’î‘±’ã ’Ü‘±‘∂‘±’ê", "’ç’à’í’è‘º‘ª‘ø ’à’ê’ç‘ø‘±’Ü"], data: [
                { w: "‘ø’°÷Å’´’∂", c:1}, { w: "‘≤’°’§", c:1}, { w: "‘±’∂’∞’°’ª’∏’≤’°’Ø", c:1}, { w: "‘º’≥’°÷É", c:1}, { w: "’â’°÷Ä’π’´’∂’•÷Ä", c:1}, { w: "’è’°’∫’°’Ø’°’Æ ’±’∏÷Ç’Ø", c:1}, { w: "‘ø’∏’ø÷Ä’°’Æ ’∏’ø÷Ñ", c:3}, { w: "‘±’∂’ø’°’º", c:1},
                { w: "’É’°’∂’≥", c:2}, { w: "‘ø’∏’ø÷Ä’°’Æ ’Ø’∏÷Ç’™", c:2}, { w: "’é’°’≠’Ø’∏’ø", c:2}, { w: "’è’´’£÷Ä’°’∂’∏÷Ç’∞’´", c:2}, { w: "’Ä’Ω’Ø’°’∂’•÷Ä", c:2}, { w: "‘ø’°’∂’°’π ’§÷Ä’∏’∑’°’Ø", c:2}, { w: "‘π’°’£’°’æ’∏÷Ä", c:2}, { w: "‘±’æ’°’∂’°’Ø", c:2},
                { w: "‘±’∂’∏÷Ä’Ω ’∏÷Ä’Ω", c:3}, { w: "’á’°’¥÷É’∏÷Ç÷Ä", c:3}, { w: "‘µ÷Ä’•÷Ñ ’£’µ’∏÷Ç’≤", c:3}, { w: "’ä’∏’π’°’ø", c:3}, { w: "‘±’∂’©÷á", c:3}, { w: "‘¥’°’∂’°’Ø", c:3}, { w: "‘≤’°’§’•÷Ä", c:3}, { w: "’Ä’∏÷Ä’Ω ’Ø’∂’∏÷Ç’∂÷Ñ’®", c:3},
                { w: "’Ä’∏÷Ç’¥’∏÷Ä’°’µ’´’∂", c:[1,2,3]}, { w: "‘∫’∏’≤’∏’æ÷Ä’§’°’Ø’°’∂", c:[1,2,3]}, { w: "’ç’∏÷Ç’ø", c:[2,3]}, { w: "’É’°’¥÷É’∏÷Ä’§’∏÷Ç’©’µ’∏÷Ç’∂", c:[1,2]}
            ]},
            { name: "’ä’∏’•’¥’∂’•÷Ä’´ ’Ä’•÷Ä’∏’Ω’∂’•÷Ä", teams: ["‘±’Ü’à’í’á (’ç‘±’ê’à)", "‘π’Ñ‘ø‘±‘≤‘µ’ê‘¥ (‘π‘±‘π’à’í‘º)", "’ì‘±’ê’é‘±’Ü‘±"], data: [
                { w: "’ç’°÷Ä’∏", c:1}, { w: "’Ñ’∏’Ω’´", c:1}, { w: "’Ä’°’¥’¢’°÷Ä’±’∏÷Ç’¥", c:1}, { w: "‘º’∏’º’æ’° ’±’∏÷Ä", c:1}, { w: "’Ä’°÷Ä’Ω’°’∂’´÷Ñ", c:1}, { w: "’é’´’∑’°’∫", c:1}, { w: "’ç’°÷Ä’•÷Ä", c:1}, { w: "‘¥’•’¢’•’§", c:1},
                { w: "’á’°’∞", c:2}, { w: "‘≥’´’∂’´", c:2}, { w: "‘¥’°’æ’°’≥’°’∂’∏÷Ç’©’µ’∏÷Ç’∂", c:2}, { w: "’ç÷á’°’π’µ’° ’Ø’´’∂", c:2}, { w: "’ã’°’æ’°’≠÷Ñ", c:2}, { w: "’Ä’°’≤’©’°’∂’°’Ø", c:2}, { w: "‘±’∂’¥’°’∞’∏÷Ç’©’µ’∏÷Ç’∂", c:2}, { w: "‘π’°’©’∏÷Ç’¨", c:2},
                { w: "‘ø÷Ä’°’Ø", c:3}, { w: "‘π’´’©’•’º", c:3}, { w: "‘±’∂’¥’°÷Ä ’Ω’•÷Ä", c:3}, { w: "‘ø’ø÷Ä’´’≥’∂’•÷Ä", c:3}, { w: "‘±’≤’ª’´’Ø", c:3}, { w: "‘º’´’≥", c:3}, { w: "’ì’°÷Ä’æ’°’∂’°", c:3}, { w: "‘º’°÷Å", c:3},
                { w: "’ç’•÷Ä", c:[1,2,3]}, { w: "’à’≤’¢’•÷Ä’£’∏÷Ç’©’µ’∏÷Ç’∂", c:[1,2,3]}, { w: "‘±’æ’°’∂’§’°’¶÷Ä’∏÷Ç’µ÷Å", c:[2,3]}, { w: "‘≥’µ’∏÷Ç’≤’°’Ø’°’∂ ’Ø’µ’°’∂÷Ñ", c:1}
            ]},
            { name: "’ç’ø’•’≤’Æ’°’£’∏÷Ä’Æ’∏÷Ç’©’µ’∏÷Ç’∂’∂’•÷Ä", teams: ["’á’à’í’Ü’Ü ’à’í ‘ø‘±’è’à’í’Ü", "‘≥‘ª’î’à’ê‘∏", "’Ñ‘ª ‘ø‘±‘π‘ª‘º ’Ñ‘µ’Ç’ê‘∏"], data: [
                { w: "‘≥’§’°’Ø", c:1}, { w: "’Ñ’∏÷Ä’©’´", c:1}, { w: "’î’•’º’´ ’î’∏÷Ç’π’´", c:1}, { w: "’ë’∏÷Ç÷Ä’ø", c:1}, { w: "‘¥’°’ø’°÷Ä’°’∂", c:1}, { w: "’é’Ø’°’∂’•÷Ä", c:1}, { w: "‘≥’¨’∏÷Ç’≠’∂ ’°’º’°’Æ", c:1}, { w: "‘ø’°’∑’´", c:1},
                { w: "’Ä’°’¥’¢’∏", c:2}, { w: "‘≤’°’¶’°’¶ ‘±÷Ä’ø’•’¥", c:2}, { w: "‘π’´÷Ü’¨’´’Ω", c:2}, { w: "‘¥’∏÷Ç÷Ñ’°’∂", c:2}, { w: "‘ø’°÷Ä’∏’ø", c:2}, { w: "’ç’°’¨’∏÷Ä", c:2}, { w: "¬´‘∑’Ω’ø’´ ’∞’°’¥’•÷Å’•÷Ñ¬ª", c:2}, { w: "‘æ’•’Æ", c:2},
                { w: "’Ñ’•’≤÷Ä", c:3}, { w: "‘Ω’°’∂’∏÷Ç’©’∫’°’∂", c:3}, { w: "’Ä’∏’æ’´’æ", c:3}, { w: "’ä’°’ø’•÷Ä’°’¶’¥", c:3}, { w: "‘π’°’£’°’æ’∏÷Ä", c:3}, { w: "’É’°’∂’≥", c:3}, { w: "‘±’æ’•÷Ä’°’Ø", c:3}, { w: "‘≥’µ’∏÷Ç’≤’°÷Å’´", c:3},
                { w: "‘ø’•’∂’§’°’∂’´’∂’•÷Ä", c:[1,3]}, { w: "’é’´’≥’°’¢’°’∂’∏÷Ç’©’µ’∏÷Ç’∂", c:[1,3]}, { w: "’î’°’≤’°÷Ñ", c:2}, { w: "’Å’¥’•’º", c:[1,2]}
            ]},
            { name: "‘Ω’∏÷Ä’°’¥’°’∂’Ø’∏÷Ç’©’µ’∏÷Ç’∂", teams: ["’ä’à’â‘±’è ‘±’Ç’é‘µ’ç‘∏", "’â‘±’ê‘ª ’é‘µ’ê’ã‘∏", "‘ø‘ª‘ø’à’ç‘ª ’Ñ‘±’Ä‘∏"], data: [
                { w: "’ä’°’º’°’æ", c:1}, { w: "‘ø’°’©", c:1}, { w: "‘ø÷Å’•’¨", c:1}, { w: "‘æ’°’º", c:3}, { w: "‘±’≤’¢’µ’∏÷Ç÷Ä", c:1}, { w: "‘ø’∏’æ", c:1}, { w: "‘±÷Ä’ø", c:1}, { w: "’â’°÷Ä’π’´", c:1},
                { w: "‘ø’Ø’∏÷Ç", c:2}, { w: "‘±’≤’æ’•’Ω", c:2}, { w: "‘±’£’º’°’æ", c:2}, { w: "’Å’°’£’∏÷Ç’Ø’∂’•÷Ä", c:2}, { w: "’ç’°÷Ä’´ ’¨’°’∂’ª", c:2}, { w: "‘µ÷Ä’Ø’°’©’•", c:2}, { w: "‘¥’°÷Ä’¢’´’∂", c:2}, { w: "‘π’°’Ø’°÷Ä’§", c:2},
                { w: "’Ä’´’¥’°÷Ä’∏÷Ç’©’µ’∏÷Ç’∂", c:3}, { w: "’à’≤’¢", c:3}, { w: "‘æ’°’º", c:3}, { w: "’î’°÷Ä", c:3}, { w: "’Ä’∏÷Ä’°÷Ñ’∏÷Ç’µ÷Ä", c:3}, { w: "‘Ω’∂’°’¥’´’∂’•÷Ä", c:3}, { w: "‘±’¨’µ’∏÷Ç÷Ä", c:3}, { w: "‘≥’∏’¥", c:3},
                { w: "‘Ω’∏÷Ä’°’¥’°’∂’Ø’∏÷Ç’©’µ’∏÷Ç’∂", c:[1,2]}, { w: "’ç’∏÷Ç’£", c:3}, { w: "‘±’∂’ø’°’º", c:2}, { w: "’É’°’∂’°’∫’°÷Ä’∞’∏÷Ä’§’∏÷Ç’©’µ’∏÷Ç’∂", c:1}
            ]},
            { name: "’ç’∏÷Å’´’°’¨’°’Ø’°’∂ ’Ä’•÷Ñ’´’°’©’∂’•÷Ä", teams: ["’è‘µ’ê’Ü ’à’í ‘æ‘±’å‘±’Ü", "’à’ç‘ø’à’í ‘ø‘±’ê‘±’ç‘∏", "‘≤‘±’ê‘µ‘ø‘µ’Ü‘¥‘±’Ü‘∏"], data: [
                { w: "’ç’´’¥’∏’∂", c:1}, { w: "’Ñ’°’©’∏’Ω", c:1}, { w: "’ä’°’µ’¥’°’∂", c:1}, { w: "‘≤’°÷Ä’Ø’°’∂’°’¨", c:1}, { w: "’î’´’© ’Ø’ø÷Ä’•’¨", c:1}, { w: "’Ä’°’¶’°÷Ä ’¥’°’∂’•’©", c:1}, { w: "’à’π’≠’°÷Ä’∂’•÷Ä", c:1}, { w: "‘±’∂’≠’´’≤’≥", c:1},
                { w: "’Ä’∏’≤’°’£’∏÷Ä’Æ", c:2}, { w: "’ï’±", c:2}, { w: "’à’Ω’Ø’´", c:2}, { w: "‘π’°’£’°’æ’∏÷Ä", c:2}, { w: "’é’•’≥", c:2}, { w: "‘ø’°÷Ä’°’Ω", c:2}, { w: "‘±’¶’∂’æ’∏÷Ç’©’µ’∏÷Ç’∂", c:2}, { w: "‘≤’°’≠’ø", c:2},
                { w: "’Ñ’°÷Ä’§ ’∏÷Ç ‘ø’´’∂", c:3}, { w: "’Ö’∏÷Ç’≤ ’∏÷Ç ’¢÷Ä’´’∂’±", c:3}, { w: "’Ä’´’¥’°÷Ä ’¥’°÷Ä’§’´’Ø", c:3}, { w: "’Å’´’°’æ’∏÷Ä", c:3}, { w: "’ì’°’≠’∏÷Ç’Ω’ø", c:3}, { w: "¬´‘≤’°÷Ä’•’Ø’•’∂’§’°’∂¬ª", c:3}, { w: "’é÷Ä’•’™", c:1}, { w: "‘Ω’°’¢’•’∏÷Ç’©’µ’∏÷Ç’∂", c:3},
                { w: "’Ä’°÷Ä’Ω’ø’∏÷Ç’©’µ’∏÷Ç’∂", c:[2,3]}, { w: "‘±’∑’≠’°’ø’°’∂÷Ñ", c:[1,2]}, { w: "‘±’£’°’∞’∏÷Ç’©’µ’∏÷Ç’∂", c:1}, { w: "‘æ’´’Æ’°’≤", c:3}
            ]},
            { name: "‘Ω÷Ä’°’ø’°’Ø’°’∂", teams: ["’Ñ‘ª ‘ø‘±‘π‘ª‘º ’Ñ‘µ’Ç’ê‘∏", "‘Ω‘µ‘º’à’î’Ü ’à’í ’Ä‘ª’Ñ‘±’ê‘∏", "’ç’à’í’è‘±’ç‘±’Ü‘∏"], data: [
                { w: "’Ñ’•’≤÷Ä", c:1}, { w: "’É’°’∂’≥", c:1}, { w: "‘ø’°’ø’∏÷Ç", c:1}, { w: "’á’∏÷Ç’∂", c:1}, { w: "‘Ω’°’∂’∏÷Ç’©’∫’°’∂", c:1}, { w: "‘≥’µ’∏÷Ç’≤’°÷Å’´", c:1}, { w: "’ä’°’ø’•÷Ä’°’¶’¥", c:1}, { w: "‘±’æ’•÷Ä’°’Ø", c:1},
                { w: "‘µ÷Ä’Ø’∏÷Ç ’•’≤’¢’°’µ÷Ä", c:2}, { w: "’à÷Ç’≤÷á’∏÷Ä’∏÷Ç’©’µ’∏÷Ç’∂", c:2}, { w: "‘ø’∏’æ’•÷Ä", c:2}, { w: "‘µ’¶’∂’•÷Ä", c:2}, { w: "’Ä’°÷Ä’Ω’ø’∏÷Ç’©’µ’∏÷Ç’∂", c:2}, { w: "’é’´’≥’°’¢’°’∂’∏÷Ç’©’µ’∏÷Ç’∂", c:2}, { w: "’Ñ’∏÷Ä’©’•’¨", c:2}, { w: "‘±÷Ä’§’°÷Ä’∏÷Ç’©’µ’∏÷Ç’∂", c:2},
                { w: "‘π’°’£’°’æ’∏÷Ä", c:3}, { w: "’ç’ø’°’≠’∏’Ω", c:3}, { w: "‘ø’∏’ø", c:3}, { w: "’à’Ω’Ø’´", c:3}, { w: "‘µ÷Ä’•÷Ñ ’Ω’∏÷Ç’ø", c:3}, { w: "‘¥’°÷Ä’∫’°’Ω", c:3}, { w: "’Ä’∂’°÷Ä’°’¥’ø’∏÷Ç’©’µ’∏÷Ç’∂", c:3}, { w: "‘≥’µ’∏÷Ç’≤’°÷Å’´", c:3},
                { w: "‘ø’∏÷Ä’∏÷Ç’Ω’ø", c:1}, { w: "’É’°’¥÷É’∏÷Ä’§", c:2}, { w: "‘Ω’•’¨÷Ñ", c:[2,3]}, { w: "’ì’∏÷Ñ÷Ä’´÷Å ’¥’•’Æ", c:1}
            ]}
        ],
        solo: [
            { name: "‘ø’•’∂’Ω’°’£÷Ä’∏÷Ç’©’µ’∏÷Ç’∂", target: "‘≥’ø’´÷Ä 10 ’≥’´’∑’ø ÷É’°’Ω’ø’•÷Ä’®", data: [
                { w: "‘¥’Ω’•’≤", c:1}, { w: "1869 ’©.", c:1}, { w: "’ï’¨’£’°", c:1}, { w: "10 ’¶’°’æ’°’Ø", c:1}, { w: "’é’•÷Ä’∂’°’ø’∏÷Ç’∂", c:1}, { w: "‘π’´÷Ü’¨’´’Ω", c:1}, { w: "’Ü’•÷Ä’Ω’´’Ω’µ’°’∂", c:1}, { w: "‘≤’°’∂’°’Ω’ø’•’≤’Æ", c:1}, { w: "’Ä’∏’æ’∞’°’∂’∂’•’Ω", c:1}, { w: "‘Ω÷Ä’´’¥’µ’°’∂", c:1},
                { w: "’ç’µ’∏÷Ç’∂’´÷Ñ", c:0}, { w: "1915 ’©.", c:0}, { w: "‘µ÷Ä÷á’°’∂", c:0}, { w: "‘≥÷Ä’´’£’∏÷Ä", c:0}, { w: "2 ’¶’°’æ’°’Ø", c:0}, { w: "’é’•’∂’•’ø’´’Ø", c:0}, { w: "’ñ÷Ä’°’∂’Ω’´’°", c:0}, { w: "‘±’∑’∏÷Ç’≤", c:0}, { w: "’Ñ’∏’Ω’Ø’æ’°", c:0}, { w: "’á’´÷Ä’°’¶", c:0},
                { w: "‘∂’∏÷Ä’°’æ’°÷Ä", c:0}, { w: "‘º’•’∂’´’∂’°’Ø’°’∂", c:0}, { w: "’â’°÷Ä’•’∂÷Å", c:0}, { w: "‘ø’∏’¥’´’ø’°’Ω", c:0}, { w: "’é’•’∫", c:0}, { w: "‘¥÷Ä’°’¥’°’ø’∏÷Ç÷Ä’£", c:0}, { w: "’Ü’Ø’°÷Ä’´’π", c:0}, { w: "1937 ’©.", c:0}
            ]},
            { name: "‘π’∏÷Ç’¥’°’∂’µ’°’∂ ’©’•’û ’à’π", target: "‘≥’ø’´÷Ä ‘π’∏÷Ç’¥’°’∂’µ’°’∂’´ 10 ’£’∏÷Ä’Æ’•÷Ä’®", data: [
                { w: "‘±’∂’∏÷Ç’∑", c:1}, { w: "‘π’¥’Ø’°’¢’•÷Ä’§", c:1}, { w: "’ì’°÷Ä’æ’°’∂’°", c:1}, { w: "‘≥’´÷Ñ’∏÷Ä’®", c:1}, { w: "’á’∏÷Ç’∂’∂ ’∏÷Ç ’Ø’°’ø’∏÷Ç’∂", c:1}, { w: "’Ñ’´ ’Ø’°’©’´’¨ ’¥’•’≤÷Ä", c:1}, { w: "’Å’°’≠’∏÷Ä’§ ’ì’°’∂’∏’Ω", c:1}, { w: "’î’°’ª ’Ü’°’¶’°÷Ä", c:1}, { w: "’ç’∏÷Ç’ø’¨’´’Ø ’∏÷Ä’Ω’Ø’°’∂", c:1}, { w: "’Ä’°’µ÷Ä’•’∂’´÷Ñ’´’Ω ’∞’•’ø", c:1},
                { w: "‘≥÷á’∏÷Ä’£ ’Ñ’°÷Ä’¶’∫’•’ø’∏÷Ç’∂’´", c:0}, { w: "’ç’°’¥’æ’•’¨", c:0}, { w: "’î’°’∏’Ω", c:0}, { w: "’Ü’°’¥’∏÷Ç’Ω", c:0}, { w: "’Ä’°’æ’•÷Ä’™’°’Ø’°’∂ ’Ω’´÷Ä’∏’æ", c:0}, { w: "‘Ω’•’∂’©’®", c:0}, { w: "’ä’•’∫’∏", c:0}, { w: "’é’°÷Ä’§’°’∂’°’∂÷Ñ", c:0}, { w: "’Ä’°÷Å’°’æ’°’∂", c:0}, { w: "’Ñ’´÷Ä’∞’°’æ", c:0},
                { w: "‘ø’°÷Ä’∏’ø", c:0}, { w: "’ä’°’ø÷Ä’°’∂÷Ñ", c:0}, { w: "’é’•÷Ä÷Ñ ’Ä’°’µ’°’Ω’ø’°’∂’´", c:0}, { w: "’ç’∫’´’ø’°’Ø ’±’´’°’æ’∏÷Ä", c:0}, { w: "’Å’°’µ’∂ ’∞’°’µ÷Ä’•’∂’µ’°÷Å", c:0}, { w: "‘±÷Ä’° ‘≥’•’≤’•÷Å’´’Ø", c:0}, { w: "’Ä’´’∂ ’°’Ω’ø’æ’°’Æ’∂’•÷Ä", c:0}, { w: "‘±’¢’∏÷Ç-‘º’°’¨’°", c:0}
            ]},
            { name: "’Ä’•÷Ä’∏’Ω’∂’•÷Ä’´ ’ä’°÷Ä’°’∞’°’∂’§’•’Ω", target: "‘≥’ø’´÷Ä ‘π’∏÷Ç’¥’°’∂’µ’°’∂’´ 10 ’∞’•÷Ä’∏’Ω’∂’•÷Ä’´’∂", data: [
                { w: "‘≥’´÷Ñ’∏÷Ä", c:1}, { w: "’ì’°’∂’∏’Ω", c:1}, { w: "’Ü’°’¶’°÷Ä", c:1}, { w: "‘±’∂’∏÷Ç’∑", c:1}, { w: "’ç’°÷Ä’∏", c:1}, { w: "’Ä’°’¥’¢’∏", c:1}, { w: "’ç’∏÷Ç’ø’¨’´’Ø", c:1}, { w: "‘π’°’©’∏÷Ç’¨", c:1}, { w: "’Ü’°’§’´÷Ä ’á’°’∞", c:1}, { w: "’Ñ’∏’Ω’´", c:1},
                { w: "’ä’•’∫’∏", c:0}, { w: "’ç’°’¥’æ’•’¨", c:0}, { w: "’ç’•’µ÷Ä’°’∂", c:0}, { w: "’ç’∏÷Ç’Ω’°’∂", c:0}, { w: "‘±’¢’´’Ω’∏’≤’∏’¥", c:0}, { w: "’ä’°’≤’ø’°’Ω’°÷Ä", c:0}, { w: "’é’°÷Ä’§’°’∂", c:0}, { w: "’ç’¥’¢’°’ø", c:0}, { w: "’ç’∏÷Ü’´", c:0}, { w: "‘±÷Ä’°", c:0},
                { w: "‘Ω’•’∂’©’®", c:0}, { w: "’Ñ’°’¶’∏÷Ç’©’´ ’Ä’°’¥’∏", c:0}, { w: "’á’∏÷Ç’∑’°’∂’´’Ø", c:0}, { w: "’Ñ’°÷Ä’°’∂", c:0}, { w: "‘±’∑’∏’ø", c:0}, { w: "‘∂’´’¥’¶’´’¥’∏’æ", c:0}, { w: "‘∑’¨’´’¶’¢’°÷Ä’∏’æ", c:0}, { w: "’Ñ’°÷Ä’¶’∫’•’ø’∏÷Ç’∂’´", c:0}
            ]}
        ],
        sequence: [
            { name: "‘≤’°’∂’°’Ω’ø’•’≤’Æ’∏÷Ç’©’µ’∏÷Ç’∂ ‚Ññ1", realName: "’á’∏÷Ç’∂’∂ ’∏÷Ç ‘ø’°’ø’∏÷Ç’∂", target: "‘¥’°’Ω’°’æ’∏÷Ä’´÷Ä ’≥’´’∑’ø ’∞’•÷Ä’©’°’Ø’°’∂’∏÷Ç’©’µ’°’¥’¢", data: [
                { w: "‘∫’°’¥’°’∂’°’Ø’∏’æ ‘ø’°’ø’∏÷Ç’∂ ’≥’∏’∂ ’ß÷Ä,", order:0}, { w: "’á’∏÷Ç’∂’∂ ’ß’¨ ’£’®’¨’≠’´’∂ ’£’®’§’°’Ø ’π’∏÷Ç’∂’•÷Ä,", order:1},
                { w: "’Ñ’´’°’µ’∂, ’£’´’ø’•’¥ ’∏’π` ’∏÷Ä’§’´’°’∂÷Å ’∏÷Ä’§’´,", order:2}, { w: "’É’°’∂’Ø’•’¨ ’ß÷Ä ’¥’´ ’£’°’º’°’∂ ’¥’∏÷Ä’©’´:", order:3},
                { w: "‘µ’Ø’°’æ ’¥’´ ÷Ö÷Ä, ’±’¥’•’º’æ’°’∂ ’¥’®’ø’´’∂,", order:4}, { w: "‘ø’°’ø’æ’´ ’Ø’∏÷Ç’∑’ø’® ’ø’°÷Ä’°’æ ’¥’∏÷Ä’©’´’∂:", order:5},
                { w: "‚Äî ‘≤’°÷Ä’´ ’°’ª’∏’≤’∏÷Ç’¥, ’∏÷Ç’Ω’ø’° ’ì’´’Ω’∏,", order:6}, { w: "‘≥’¨’∏÷Ç’≠’®’Ω ’¥’®÷Ä’Ω’•÷Å, ’´ ’Ω’•÷Ä ‘±’Ω’ø’Æ’∏,", order:7},
                { w: "‘±’õ’º ’ß’Ω ’¥’∏÷Ä’©’´’∂ ’∏÷Ç ’´’∂’± ’∞’°’¥’°÷Ä", order:8}, { w: "’Ñ’´ ’£’§’°’Ø ’Ø’°÷Ä’´ ’£’®’¨’≠’´’Ω ’∞’°÷Ä’¥’°÷Ä:", order:9}
            ]},
            { name: "‘≤’°’∂’°’Ω’ø’•’≤’Æ’∏÷Ç’©’µ’∏÷Ç’∂ ‚Ññ2", realName: "‘±’º’°’ª’´’∂ ’±’µ’∏÷Ç’∂’®", target: "‘¥’°’Ω’°’æ’∏÷Ä’´÷Ä ’≥’´’∑’ø ’∞’•÷Ä’©’°’Ø’°’∂’∏÷Ç’©’µ’°’¥’¢", data: [
                { w: "‚Äï ’é’°’ú’µ, ’¥’°’µ÷Ä’´’õ’Ø ’ª’°’∂, ’ø’•’ú’Ω,", order:0}, { w: "‘≤’°’Ø’∂ ’∏÷Ç ’§’∏÷Ç’º’® ’¨’´", order:1},
                { w: "‘ª’∂’π÷Ñ’°’ú’∂ ’Ω’∫’´’ø’°’Ø", order:2}, { w: "‘π’´’©’•’º ’ß ’£’°’¨’´...", order:3},
                { w: "‘∑’Ω÷Ñ’°’∂ ’∑’°’ø ’©’´’©’•’º", order:4}, { w: "’â’•’¥ ’ø’•’Ω’•’¨ ’•’Ω ’§’•’º÷â", order:5},
                { w: "‚Äï ’â’ß’õ, ’´’¥ ’°’∂’∏÷Ç’∑’´’Ø,", order:6}, { w: "‘π’´’©’•’º’∂’•÷Ä ’π’•’∂ ’ß’ø.", order:7},
                { w: "‘π’´’©’•’º’∂’•÷Ä’∂ ’°’∂÷Å’°’∂", order:8}, { w: "‘æ’°’≤’´’Ø’∂’•÷Ä’´ ’∞’•’ø÷â", order:9},
                { w: "‘∑’ø ’±’µ’∏÷Ç’∂’∂ ’ß ’£’°’¨’´,", order:10}, { w: "’ì’°’©’´’¨’∂ ’ß ’±’µ’∏÷Ç’∂’´,", order:11},
                { w: "’à÷Ä ’Ø’°÷Ä’Æ’•’Ω ’Ω’∫’´’ø’°’Ø", order:12}, { w: "‘π’´’©’•’º’∂’´’Ø ’¨’´’∂’´÷â", order:13}
            ]},
            { name: "‘≤’°’∂’°’Ω’ø’•’≤’Æ’∏÷Ç’©’µ’∏÷Ç’∂ ‚Ññ3", realName: "‘±’∂’∏÷Ç’∑ (’Ä’°’ø’æ’°’Æ)", target: "‘¥’°’Ω’°’æ’∏÷Ä’´÷Ä ’≥’´’∑’ø ’∞’•÷Ä’©’°’Ø’°’∂’∏÷Ç’©’µ’°’¥’¢", data: [
                { w: "‘±’ú’≠, ’´’ú’∂’π ’¨’°’æ ’•’∂ ’Ω’°÷Ä’´ ’æ’®÷Ä’°", order:0}, { w: "‘±’∂÷Å’∂’∏÷Ç’¥ ÷Ö÷Ä’•÷Ä’∂, ’°’∂’∏’ú÷Ç’∑, ’°’∂’∏’ú÷Ç’∑,", order:1},
                { w: "‘±’∂’®÷Ä’ª’°’µ’´’∂, ’©’•’©÷á’°’Ω’°’∞", order:2}, { w: "‘±’¥’∫ ’∏÷Ç ’∞’∏’æ’•÷Ä’∂ ’°’∂’∏’ú÷Ç’∑, ’°’∂’∏’ú÷Ç’∑÷â", order:3},
                { w: "‘±’∞’° ’¢’°÷Å’æ’•÷Å ’©’°÷Ä’¥ ’°’º’°’æ’∏’ø", order:4}, { w: "’é’°÷Ä’§ ’ß ’©’°÷É’∏÷Ç’¥ ’Ω’°÷Ä’´’∂-÷Ñ’°÷Ä’´’∂,", order:5},
                { w: "’á’°’≤ ’•’∂ ’∑’∏’≤’∏÷Ç’¥ ’Æ’°’≤’´’Ø ’∏÷Ç ’≠’∏’ø,", order:6}, { w: "’á’®’∂’π’∏÷Ç’¥ ’¢’∏÷Ç÷Ä’¥’∏÷Ç’∂÷Ñ ’•’§’•’¥’°’µ’´’∂÷â", order:7},
                { w: "‘±’ú’≠, ’´’ú’∂’π ’∞’•’∑’ø ’•’∂ ’Ω’°÷Ä’´ ’æ’®÷Ä’°", order:8}, { w: "’ç’°’∞’∏÷Ç’¥ ’™’°’¥’•÷Ä’∂ ’°’∂’∏’ú÷Ç’∑, ’°’∂’∏’ú÷Ç’∑,", order:9},
                { w: "’á’®’æ’´’∂ ÷É’®’π’•÷Å ’∞’∏’æ’´’æ’∂ ’°’∞’°‚Äï", order:10}, { w: "‘±’≤’ª’´’Ø’∂ ’∏÷Ç ’Ω’•÷Ä’∂ ’°’∂’∏’ú÷Ç’∑, ’°’∂’∏’ú÷Ç’∑÷â", order:11}
            ]}
        ]
    };

    function showScreen(id) {
        document.querySelectorAll('body > div').forEach(d => d.classList.add('hidden'));
        document.getElementById(id).classList.remove('hidden');
        if (id === 'screen-main-menu') {
            document.getElementById('global-back-btn').classList.add('hidden');
        } else {
            document.getElementById('global-back-btn').classList.remove('hidden');
        }
    }

    function goToMainMenu() {
        if (peer) { peer.destroy(); peer = null; conn = null; connections = {}; }
        showScreen('screen-main-menu');
    }

    // --- LOCAL MODE (3 TEAMS) ---
    let localState = { turn: 1, scores: {1:0, 2:0, 3:0}, history: [], usedCount: 0, totalItems: 0 };

    function startLocalMode() {
        showScreen('screen-local-game');
        const menu = document.getElementById('local-menu');
        menu.innerHTML = "";
        document.getElementById('local-game-board').classList.add('hidden');
        DB.standard.forEach((game) => {
            let btn = document.createElement('button');
            btn.className = 'btn btn-gold';
            btn.innerText = game.name;
            btn.onclick = () => initLocalGame(game);
            menu.appendChild(btn);
        });
    }

    function initLocalGame(game) {
        localState = { turn: 1, scores: {1:0, 2:0, 3:0}, history: [], usedCount: 0, totalItems: game.data.length };
        document.getElementById('local-game-title').innerText = game.name;
        document.getElementById('local-game-board').classList.remove('hidden');
        document.getElementById('local-counter').innerText = "0 / " + localState.totalItems;
        
        const teamsDiv = document.getElementById('local-teams');
        teamsDiv.innerHTML = "";
        game.teams.forEach((tName, i) => {
            teamsDiv.innerHTML += `
                <div class="team-card ${i+1===1?'turn':''}" id="l-team-${i+1}">
                    <div class="team-name" contenteditable="true">‘π‘ª’Ñ ${i+1}</div>
                    <div style="font-size:14px; color:#aaa; margin-bottom:5px;">${tName}</div>
                    <div class="team-score" id="l-score-${i+1}">0</div>
                    <div class="team-list" id="l-list-${i+1}"></div>
                </div>`;
        });

        const grid = document.getElementById('local-grid');
        grid.innerHTML = "";
        let items = [...game.data].sort(() => Math.random() - 0.5);
        items.forEach(item => {
            let div = document.createElement('div');
            div.className = 'word';
            div.innerText = item.w;
            div.onclick = () => handleLocalClick(div, item);
            grid.appendChild(div);
        });
    }

    function handleLocalClick(div, item) {
        if (div.classList.contains('used')) return;
        let t = localState.turn;
        let isCorrect = Array.isArray(item.c) ? item.c.includes(t) : item.c === t;
        localState.history.push({ div: div, turn: t, correct: isCorrect, word: item.w });
        
        if (isCorrect) {
            localState.scores[t]++;
            localState.usedCount++;
            div.classList.add('used', 'correct');
            document.getElementById(`l-list-${t}`).innerHTML += item.w + ", ";
        } else {
            div.classList.add('error');
            setTimeout(() => div.classList.remove('error'), 500);
        }
        
        document.getElementById(`l-score-${t}`).innerText = localState.scores[t];
        document.getElementById('local-counter').innerText = localState.usedCount + " / " + localState.totalItems;

        if (localState.usedCount === localState.totalItems) {
            finishLocalGame();
        } else {
            localState.turn = (t % 3) + 1;
            updateLocalUI();
        }
    }

    function finishLocalGame() {
        let results = [
            { id: 1, name: document.querySelector(`#l-team-1 .team-name`).innerText, score: localState.scores[1] },
            { id: 2, name: document.querySelector(`#l-team-2 .team-name`).innerText, score: localState.scores[2] },
            { id: 3, name: document.querySelector(`#l-team-3 .team-name`).innerText, score: localState.scores[3] }
        ];
        results.sort((a, b) => b.score - a.score);
        let maxScore = results[0].score;
        let winners = results.filter(r => r.score === maxScore);
        
        document.getElementById('final-winner-title').innerText = winners.length > 1 ? "ü§ù ’à’â-’à’î‘ª ü§ù" : `üèÜ ${winners[0].name} ’Ä‘±’Ç‘π‘µ’ë üèÜ`;
        let html = '<table class="winner-table">';
        let currentRank = 1;
        for (let i = 0; i < results.length; i++) {
            if (i > 0 && results[i].score < results[i-1].score) currentRank = i + 1;
            let points = currentRank === 1 ? 2 : (currentRank === 2 ? 1 : 0);
            let cls = currentRank === 1 ? 'rank-1' : (currentRank === 2 ? 'rank-2' : 'rank-3');
            let icon = currentRank === 1 ? 'ü•á' : (currentRank === 2 ? 'ü•à' : 'ü•â');
            html += `<tr><td class="${cls}">${icon}</td><td class="${cls}"><span class="winner-team-name">${results[i].name}</span></td><td class="winner-stats">${results[i].score} ’¢’°’º</td><td class="winner-stats" style="color:#fff">${points} ’Ñ’´’°’æ’∏÷Ä</td></tr>`;
        }
        html += '</table>';
        document.getElementById('winner-name').innerHTML = html;
        document.getElementById('winner-overlay').classList.remove('hidden');
        document.getElementById('winner-overlay').style.display = 'flex';
    }

    function localUndo() {
        if (localState.history.length === 0) return;
        let last = localState.history.pop();
        localState.turn = last.turn;
        if (last.correct) {
            localState.scores[last.turn]--;
            localState.usedCount--;
            last.div.classList.remove('used', 'correct');
            let list = document.getElementById(`l-list-${last.turn}`);
            list.innerText = list.innerText.replace(last.word + ", ", "");
        }
        document.getElementById(`l-score-${last.turn}`).innerText = localState.scores[last.turn];
        document.getElementById('local-counter').innerText = localState.usedCount + " / " + localState.totalItems;
        updateLocalUI();
    }

    function updateLocalUI() {
        for(let i=1; i<=3; i++) document.getElementById(`l-team-${i}`).classList.toggle('turn', i === localState.turn);
        document.getElementById('local-msg').innerText = `’Ä’•÷Ä’©’®’ù ‘π’´’¥ ${localState.turn}`;
    }

    function forceBackToMenu() {
        document.getElementById('winner-overlay').style.display = 'none';
        goToMainMenu();
    }

    // --- ONLINE (PEERJS) ---
    let peer = null;
    let conn = null;
    let connections = {}; 
    let onlineMode = ""; 
    let myName = "";

    function openOnlinePortal(mode) {
        onlineMode = mode;
        showScreen('screen-online-portal');
        document.getElementById('online-portal-title').innerText = mode === 'solo' ? "’à’í’á‘±‘¥’ê’à’í‘π’Ö’à’í’Ü" : "’Ä‘±’é‘±’î‘ª’ê ’è’à’Ç‘µ’ê‘∏";
    }

    function setupHost() {
        let code = Math.floor(1000 + Math.random() * 9000).toString();
        peer = new Peer("tumo_" + code, peerConfig);
        
        peer.on('open', (id) => {
            document.getElementById('host-code-display').innerText = code;
            showScreen('screen-host-lobby');
            renderHostGameList();
        });
        peer.on('connection', (c) => {
            c.on('data', (data) => handleHostData(c, data));
            c.on('close', () => { delete connections[c.peer]; updateHostPlayerList(); });
        });
        peer.on('error', (err) => alert("‘ø’°’∫’´ ’Ω’≠’°’¨: ’ì’∏÷Ä’±’•÷Ñ ’∂’∏÷Ä’´÷Å: " + err.type));
    }

    function renderHostGameList() {
        const list = document.getElementById('host-game-list');
        list.innerHTML = "";
        DB[onlineMode].forEach((g) => {
            let btn = document.createElement('button');
            btn.className = 'btn btn-blue';
            btn.innerText = g.name;
            btn.onclick = () => startOnlineGame(g);
            list.appendChild(btn);
        });
    }

    function startOnlineGame(game) {
        Object.values(connections).forEach(c => c.send({ type: 'start', game: game, mode: onlineMode }));
        showScreen('screen-host-live');
        document.getElementById('live-game-title').innerText = game.name;
        document.getElementById('live-leaderboard').innerHTML = "";
        Object.values(connections).forEach(c => {
            c.metadata.score = 0; c.metadata.errors = 0; c.metadata.finished = false;
            c.metadata.max = (onlineMode==='solo') ? 10 : game.data.length;
        });
        updateLeaderboard();
    }

    function handleHostData(c, data) {
        if (data.type === 'join') {
            c.metadata = { name: data.name, score:0, errors:0, finished:false, max:10, peerId: c.peer };
            connections[c.peer] = c;
            updateHostPlayerList();
        } else if (data.type === 'update') {
            c.metadata.score = data.score;
            c.metadata.errors = data.errors;
            c.metadata.finished = data.finished;
            updateLeaderboard();
        }
    }

    function updateHostPlayerList() {
        const div = document.getElementById('host-player-list');
        div.innerHTML = "";
        Object.values(connections).forEach(c => {
            let tag = document.createElement('span');
            tag.className = 'player-tag';
            tag.innerText = c.metadata.name;
            div.appendChild(tag);
        });
    }

    function updateLeaderboard() {
        const board = document.getElementById('live-leaderboard');
        board.innerHTML = "";
        let players = Object.values(connections).map(c => c.metadata);
        players.sort((a,b) => {
            if (a.finished && !b.finished) return -1;
            if (!a.finished && b.finished) return 1;
            return b.score - a.score;
        });
        players.forEach(p => {
            let pct = (p.score / p.max) * 100;
            let row = document.createElement('div');
            row.className = 'lb-row';
            row.style.border = p.finished ? "2px solid #ffd700" : "none";
            row.innerHTML = `<div class="lb-name">${p.name} ${p.finished?'üèÜ':''}</div><div class="lb-stat">${p.score}/${p.max}</div><div class="lb-stat" style="color:#c0392b">‚ùå ${p.errors}</div><div class="bar-container"><div class="bar-fill" style="width:${pct}%"></div></div>`;
            board.appendChild(row);
        });
    }

    function endOnlineGame() {
        Object.values(connections).forEach(c => c.send({ type: 'end' }));
        showOnlineWinners();
    }

    function showOnlineWinners() {
        let players = Object.values(connections).map(c => c.metadata);
        
        // Sorting: 1. Finished, 2. Fewest Errors
        players.sort((a,b) => {
            if (a.finished && !b.finished) return -1;
            if (!a.finished && b.finished) return 1;
            if (a.finished) return a.errors - b.errors; 
            return b.score - a.score;
        });

        let html = '<table class="winner-table">';
        let currentRank = 1;

        for (let i = 0; i < players.length; i++) {
            if (i > 0) {
                let prev = players[i-1];
                let curr = players[i];
                let tie = false;
                if (prev.finished && curr.finished) {
                    if (prev.errors === curr.errors) tie = true;
                } else if (!prev.finished && !curr.finished) {
                    if (prev.score === curr.score) tie = true;
                }
                if (!tie) currentRank = i + 1;
            }

            // SEND PERSONAL RESULT
            let conn = connections[players[i].peerId];
            if (conn) {
                conn.send({
                    type: 'gameOver',
                    rank: currentRank,
                    errors: players[i].errors,
                    finished: players[i].finished
                });
            }

            let cls = currentRank === 1 ? 'rank-1' : (currentRank === 2 ? 'rank-2' : 'rank-3');
            let icon = currentRank === 1 ? 'ü•á' : (currentRank === 2 ? 'ü•à' : 'ü•â');
            if (currentRank > 3) icon = `#${currentRank}`;
            let status = players[i].finished ? `${players[i].errors} ’ç’≠’°’¨` : `’â’´ ’°’æ’°÷Ä’ø’•’¨ (${players[i].score})`;

            html += `<tr><td class="${cls}">${icon}</td><td class="${cls}"><span class="winner-team-name">${players[i].name}</span></td><td class="winner-stats" style="color:#fff">${status}</td></tr>`;
        }
        html += '</table>';

        document.getElementById('final-winner-title').innerText = "‘±’ê‘¥’Ö’à’í’Ü’î’Ü‘µ’ê";
        document.getElementById('winner-name').innerHTML = html;
        document.getElementById('winner-overlay').classList.remove('hidden');
        document.getElementById('winner-overlay').style.display = 'flex';
        document.getElementById('screen-host-live').classList.add('hidden');
    }

    // --- PLAYER ---
    function joinRoom() {
        myName = document.getElementById('p-name').value;
        let code = document.getElementById('p-code').value;
        if (!myName || !code) return alert("‘º÷Ä’°÷Å÷Ä’•÷Ñ ’ø’æ’µ’°’¨’∂’•÷Ä’®");
        
        peer = new Peer(null, peerConfig);
        peer.on('open', () => {
            conn = peer.connect("tumo_" + code);
            conn.on('open', () => {
                conn.send({ type: 'join', name: myName });
                showScreen('screen-player');
                document.getElementById('player-waiting').classList.remove('hidden');
                document.getElementById('player-playing').classList.add('hidden');
                document.getElementById('player-final-screen').style.display = 'none';
            });
            conn.on('data', (data) => {
                if (data.type === 'start') initPlayerGame(data.game, data.mode);
                if (data.type === 'gameOver') showPlayerResult(data);
            });
            conn.on('error', () => alert("’ç’•’∂’µ’°’Ø’® ’π’£’ø’∂’æ’•÷Å"));
        });
    }

    function showPlayerResult(data) {
        document.getElementById('player-playing').classList.add('hidden');
        const screen = document.getElementById('player-final-screen');
        screen.style.display = 'flex';
        
        let icon = data.rank === 1 ? 'ü•á' : (data.rank === 2 ? 'ü•à' : (data.rank === 3 ? 'ü•â' : ''));
        let title = data.rank === 1 ? '’Ä‘±’Ç‘π‘±’Ü‘±‘ø' : `${data.rank}-÷Ä’§ ’è‘µ’Ç`;
        let color = data.rank === 1 ? '#ffd700' : '#fff';

        document.getElementById('p-final-rank').innerText = icon;
        document.getElementById('p-final-title').innerText = title;
        document.getElementById('p-final-title').style.color = color;
        document.getElementById('p-final-stats').innerText = `’ç’≠’°’¨’∂’•÷Ä’ù ${data.errors}`;
        
        let msg = "";
        if (data.rank === 1) msg = "’á’∂’∏÷Ä’∞’°’æ’∏÷Ä’∏÷Ç’¥ ’•’∂÷Ñ, ’∞’´’°’∂’°’¨’´ ’°÷Ä’§’µ’∏÷Ç’∂÷Ñ:";
        else if (data.rank <= 3) msg = "’á’°’ø ’¨’°’æ ’°÷Ä’§’µ’∏÷Ç’∂÷Ñ:";
        else msg = "‘º’°’æ ÷É’∏÷Ä’± ’ß÷Ä:";
        
        document.getElementById('p-final-msg').innerText = msg;
    }

    let pState = { score:0, errors:0, seqIdx:0, max:0 };

    function initPlayerGame(game, mode) {
        document.getElementById('player-waiting').classList.add('hidden');
        document.getElementById('player-playing').classList.remove('hidden');
        document.getElementById('player-final-screen').style.display = 'none';
        
        document.getElementById('player-target').innerText = game.target;
        
        const collectedBox = document.getElementById('player-collected-lines');
        collectedBox.innerText = "";
        if (mode === 'sequence') collectedBox.classList.remove('hidden');
        else collectedBox.classList.add('hidden');

        const grid = document.getElementById('player-grid');
        grid.innerHTML = "";
        
        pState = { score:0, errors:0, seqIdx:0, max: (mode==='solo'?10:game.data.length) };
        let items = [...game.data].sort(() => Math.random() - 0.5);

        items.forEach(item => {
            let div = document.createElement('div');
            div.className = 'word';
            div.innerText = item.w;
            div.onclick = () => {
                if (div.classList.contains('used') || div.classList.contains('error')) return;
                
                let correct = false;
                if (mode === 'solo') {
                    if (item.c === 1) { correct = true; pState.score++; }
                    else { pState.errors++; }
                } else {
                    if (item.order === pState.seqIdx) { correct = true; pState.score++; pState.seqIdx++; }
                    else { pState.errors++; }
                }

                if (correct) {
                    div.classList.add('used', 'correct');
                    if (mode === 'sequence') collectedBox.innerText += item.w + "\n";
                } else {
                    div.classList.add('error');
                    setTimeout(() => div.classList.remove('error'), 500);
                }

                let finished = (pState.score >= pState.max);
                conn.send({ type: 'update', score: pState.score, errors: pState.errors, finished: finished });

                if (finished) {
                    document.getElementById('player-playing').classList.add('hidden');
                }
            };
            grid.appendChild(div);
        });
    }
</script>
</body>
</html>
